var k=Object.defineProperty;var v=(n,e,t)=>e in n?k(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var r=(n,e,t)=>(v(n,typeof e!="symbol"?e+"":e,t),t);import{h as L,w as C,y as G,u as F,L as T,a as m,b as I,R as V,c as H,d as z,x as O,_ as E,H as x}from"./vendor-e7703df7.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}})();const p=n=>n.layer.type==="graphics",j=n=>n.type==="CIMVectorMarker",$=n=>n.type==="CIMPictureMarker";class q{constructor({layerView:e,mapView:t}){r(this,"mapView");r(this,"parentLayerView");r(this,"animationGraphicsLayer");r(this,"animatedGraphics");r(this,"graphicsObjectIdsToFilter",new Set);this.mapView=t,this.animatedGraphics={},this.parentLayerView=e,this.animationGraphicsLayer=this.setupAnimatedGraphicsLayer(e)}setupAnimatedGraphicsLayer(e){return p(e)?e.layer:(this.animationGraphicsLayer=new L({effect:e.layer.effect}),this.mapView.map.add(this.animationGraphicsLayer,this.mapView.layerViews.findIndex(t=>t===e)+1),e.featureEffect=new C({includedEffect:"opacity(0.001%)",filter:new G({where:"1<>1"})}),this.animationGraphicsLayer)}addExcludedFeature(e){this.graphicsObjectIdsToFilter.add(e),this.updateExcludedFeatures()}removeExcludedFeature(e){this.graphicsObjectIdsToFilter.delete(e),this.updateExcludedFeatures()}updateExcludedFeatures(){this.parentLayerView.featureEffect.filter=new G({where:`${this.parentLayerView.layer.objectIdField} IN ( ${Array.from(this.graphicsObjectIdsToFilter).join(",")} ) `})}hasAnimatedGraphic(e){const t=this.getGraphicId(e);return t!==void 0&&this.animatedGraphics[t]!==void 0}getAnimatedGraphic(e){const t=this.getGraphicId(e);return this.animatedGraphics[t.toString()]}getAllAnimatedGraphics(){return Object.values(this.animatedGraphics)??[]}makeAnimatableSymbol({graphic:e,easingConfig:t,isOverlay:s=!1}){const i=this.getGraphicId(e);if(this.hasAnimatedGraphic(e))return this.getAnimatedGraphic(e);const a=g.createAnimatedGraphic({graphic:e,easingConfig:t});return this.animatedGraphics[i.toString()]=a,p(this.parentLayerView)||(this.animationGraphicsLayer.add(a),s||this.addExcludedFeature(i)),a}removeAnimatedGraphic(e){const t=this.getGraphicId(e);if(this.hasAnimatedGraphic(e)){const s=this.getAnimatedGraphic(e);p(this.parentLayerView)?s.symbolAnimation.resetSymbol():(this.removeExcludedFeature(t),window.setTimeout(()=>{this.removeAnimatedGraphic(s),this.animationGraphicsLayer.remove(s)},50)),delete this.animatedGraphics[t.toString()]}}getGraphicId(e){return e.getObjectId()??`${e.uid}-uid`}}class g{constructor({graphic:e,easingConfig:t}){r(this,"easingConfig");r(this,"graphic");r(this,"originalSymbol");r(this,"animationStartTimeStamp",0);r(this,"easeOutQuad",e=>e*(2-e));r(this,"updateSimpleMarkerScale",(e,t,s,{to:i})=>{const{size:a}=t,{size:o}=s,c=s.clone();return c.size=o+(a*i-o)*e,c});r(this,"updatePictureMarkerScale",(e,t,s,{to:i})=>{const{height:a,width:o}=t,{height:c,width:l}=s,h=s.clone();return h.width=l+(o*i-l)*e,h.height=c+(a*i-c)*e,console.log(h.width),console.log(h.height),h});r(this,"updateCIMSymbolPointMarkerScale",(e,t,s,{to:i})=>{const a=s.clone();for(const[o,c]of a.data.symbol.symbolLayers.entries()){if(j(c)){const l=t.data.symbol.symbolLayers[o];c.size=c.size+(l.size*i-c.size)*e}if($(c)){const l=t.data.symbol.symbolLayers[o];c.size=c.size+(l.size*i-c.size)*e}}return a});r(this,"abortCurrentAnimation",()=>{});this.graphic=e,this.originalSymbol=e.symbol.clone(),this.easingConfig=t}static createAnimatedGraphic({graphic:e,easingConfig:t}){return e.symbolAnimation=new g({graphic:e,easingConfig:t}),e}resetAnimationTimeStamp(){this.animationStartTimeStamp=0}start(e){switch(e.type){case"symbol-scale":this.animateMarkerSize(e)}}animateMarkerSize(e){switch(this.originalSymbol.type){case"simple-marker":{this.animateSymbol(e,this.updateSimpleMarkerScale);break}case"picture-marker":{this.animateSymbol(e,this.updatePictureMarkerScale);break}case"cim":{this.animateSymbol(e,this.updateCIMSymbolPointMarkerScale);break}}}animateSymbol(e,t){var c,l;const s=this.graphic.symbol.clone(),i=this.easingConfig.type==="spring"?new F(0,{to:1,config:this.easingConfig.options}):null;(c=this.abortCurrentAnimation)==null||c.call(this),(l=e==null?void 0:e.onStart)==null||l.call(e);let a=!1;const o=h=>{var b,w,S,A;this.animationStartTimeStamp===0&&(this.animationStartTimeStamp=h);const d=h-this.animationStartTimeStamp;if(a){this.resetAnimationTimeStamp();return}if(this.easingConfig.type==="easing"&&d>(((b=this.easingConfig.options)==null?void 0:b.duration)??0)||(i==null?void 0:i.idle)===!0){this.resetAnimationTimeStamp(),(w=e==null?void 0:e.onFinish)==null||w.call(e);return}let u=0;switch(this.easingConfig.type){case"easing":{u=this.calculateEasingProgress(((S=this.easingConfig.options)==null?void 0:S.easingFunction)??"linear",d/(((A=this.easingConfig.options)==null?void 0:A.duration)??0));break}case"spring":if(i){i.advance(d),u=i==null?void 0:i.get();break}}this.graphic.symbol=t(u,this.originalSymbol,s,e),window.requestAnimationFrame(o)};window.requestAnimationFrame(o),this.abortCurrentAnimation=()=>{a=!0}}resetSymbol(){this.graphic.symbol=this.originalSymbol}calculateEasingProgress(e,t){return typeof e=="function"?e(t):T[e](t)}}const N="/Arcgis-Animate-Markers/assets/bugle-f4909af2.wav",R="/Arcgis-Animate-Markers/assets/cat-427afe9d.wav",W="/Arcgis-Animate-Markers/assets/drums-a00e44f7.mp3",D="/Arcgis-Animate-Markers/assets/guitar-ecd5b111.wav",K="/Arcgis-Animate-Markers/assets/trumpet-c3f50bf2.wav";function Q(n,e){let t,s,i;const a=async()=>{s&&(i=n(...s),s=void 0),t=void 0};return async(...o)=>(s=o,t||(i=n(...o),t=window.setTimeout(a,e)),i)}class Z{constructor({symbolAnimationManager:e,mapView:t,layerView:s,scaleFactor:i,easingConfig:a={type:"spring",options:{tension:280,friction:40,mass:10}}}){r(this,"mapView");r(this,"layerView");r(this,"scaleFactor");r(this,"easingConfig");r(this,"symbolAnimationManager");r(this,"clickHandler");r(this,"hoverHandler");r(this,"meowSound",new m.Howl({src:R}));r(this,"trumpetSound",new m.Howl({src:K}));r(this,"hornSound",new m.Howl({src:N}));r(this,"guitarSound",new m.Howl({src:D}));r(this,"drumSounds",new m.Howl({src:W,sprite:{kick:[0,350],hihat:[374,160],snare:[666,290],cowbell:[968,200]}}));r(this,"hoverHitTest",Q(async(e,t)=>{const{results:s}=await this.mapView.hitTest(e,t);s.filter(a=>a.type="graphic").length?this.mapView.container.style.cursor="pointer":this.mapView.container.style.cursor="default"},70));r(this,"clickHitTest",async(e,t)=>{const{results:s}=await this.mapView.hitTest(e,t),i=s.filter(a=>a.type="graphic");if(i.length){const a=i[0].graphic;a.symbol=await V(a),this.activeGraphic=a}else this.activeGraphic=null});this.mapView=t,this.layerView=s,this.scaleFactor=i,this.easingConfig=a,this.symbolAnimationManager=e,this.clickHandler=I(()=>this.mapView,"click",o=>{const c={include:[this.layerView.layer]};this.clickHitTest(o,c)}),this.hoverHandler=I(()=>this.mapView,"pointer-move",o=>{const c={include:[this.layerView.layer]};this.hoverHitTest(o,c)})}set activeGraphic(e){if(e){const t=this.symbolAnimationManager.makeAnimatableSymbol({graphic:e,easingConfig:this.easingConfig});this.animatePointPopEffect(t)}}animatePointPopEffect(e){e.symbolAnimation.start({type:"symbol-scale",to:this.scaleFactor,onStart:()=>{const t=()=>this.cancelAnimation(e);switch(e.attributes.soundType){case"cat":{this.playSound(this.meowSound,t);break}case"trumpet":{this.playSound(this.trumpetSound,t);break}case"horn":{this.playSound(this.hornSound,t);break}case"guitar":{this.playSound(this.guitarSound,t);break}case"drum":{Math.random()>.5?this.playSound(this.drumSounds,t,"snare"):this.playSound(this.drumSounds,t,"hihat");break}}}})}cancelAnimation(e){e.symbolAnimation.start({type:"symbol-scale",to:1,onFinish:()=>{this.symbolAnimationManager.removeAnimatedGraphic(e)}})}playSound(e,t,s){e.off();const i=e.play(s);e.on("end",()=>{e.playing(i)===!1&&t()},i)}destroy(){this.clickHandler.remove(),this.hoverHandler.remove()}}class _{constructor({symbolAnimationManager:e,graphics:t}){r(this,"symbolAnimationManager");r(this,"intervalId");this.symbolAnimationManager=e,this.intervalId=this.animateRandomItem(t)}animateRandomItem(e){return window.setInterval(()=>{const t=Math.floor(Math.random()*e.length),i=e[t].clone();i.symbol=new H({color:[255,255,255,0],size:30,outline:{color:[255,0,0,.7],style:"solid",width:5}});const a=this.symbolAnimationManager.makeAnimatableSymbol({graphic:i,easingConfig:{type:"easing",options:{easingFunction:"easeInOutCubic",duration:1e3}}});a.symbolAnimation.start({type:"symbol-scale",to:1.7,onFinish:()=>{this.symbolAnimationManager.removeAnimatedGraphic(a)}})},3e3)}destroy(){window.clearInterval(this.intervalId)}}const M=new z({basemap:new O({portalItem:{id:"a8c045aa74d643cc9e2fa2702cc4cb45"}})}),y=new E({container:"viewDiv",map:M,constraints:{minZoom:10},center:[-2.362,51.383],zoom:15}),f=new x({portalItem:{id:"ae3681977a0749e98867e42728196b3a"},popupEnabled:!1});M.add(f);y.whenLayerView(f).then(async n=>{const e=new q({mapView:y,layerView:n});new Z({symbolAnimationManager:e,mapView:y,layerView:n,scaleFactor:1.5});const t=await f.queryFeatures({where:"1=1",returnGeometry:!0});new _({symbolAnimationManager:e,graphics:t.features})});
