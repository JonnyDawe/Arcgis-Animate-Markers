var C=Object.defineProperty;var I=(n,e,t)=>e in n?C(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var s=(n,e,t)=>(I(n,typeof e!="symbol"?e+"":e,t),t);import{h as d,a as u,R as b,c as H,d as G,y as k,L as P,x,_ as T,H as L,S as F,p as M,m as E}from"./vendor-11df6bed.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function t(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(a){if(a.ep)return;a.ep=!0;const i=t(a);fetch(a.href,i)}})();const O="/Arcgis-Animate-Markers/assets/bugle-f4909af2.wav",_="/Arcgis-Animate-Markers/assets/cat-427afe9d.wav",z="/Arcgis-Animate-Markers/assets/drums-a00e44f7.mp3",R="/Arcgis-Animate-Markers/assets/guitar-559adb71.wav",N="/Arcgis-Animate-Markers/assets/trumpet-c3f50bf2.wav";function v(n,e){let t,o,a;const i=async()=>{o&&(a=n(...o),o=void 0),t=void 0};return async(...r)=>(o=r,t||(a=n(...r),t=window.setTimeout(i,e)),a)}class D{constructor({symbolAnimationManager:e,mapView:t,layerView:o,to:a,easingConfig:i}){s(this,"mapView");s(this,"layerView");s(this,"to");s(this,"easingConfig");s(this,"symbolAnimationManager");s(this,"clickHandler");s(this,"hoverHandler");s(this,"sounds",{meowSound:new d.Howl({src:_}),trumpetSound:new d.Howl({src:N}),hornSound:new d.Howl({src:O}),guitarSound:new d.Howl({src:R}),drumSounds:new d.Howl({src:z,sprite:{kick:[0,350],hihat:[374,160],snare:[666,290],cowbell:[968,200]}})});s(this,"hoverHitTest",v(async(e,t)=>{const{results:o}=await this.mapView.hitTest(e,t);o.filter(i=>i.type="graphic").length?this.mapView.container.style.cursor="pointer":this.mapView.container.style.cursor="default"},70));s(this,"clickHitTest",async(e,t)=>{const{results:o}=await this.mapView.hitTest(e,t),a=o.filter(i=>i.type="graphic");if(a.length){const i=a[0].graphic;i.symbol=await b(i);const r=this.symbolAnimationManager.makeAnimatableSymbol({graphic:i,easingConfig:this.easingConfig});this.animatePointPopEffect(r)}});this.mapView=t,this.layerView=o,this.to=a,this.easingConfig=i,this.symbolAnimationManager=e,this.clickHandler=u(()=>this.mapView,"click",r=>{const c={include:[this.layerView.layer]};this.clickHitTest(r,c)}),this.hoverHandler=u(()=>this.mapView,"pointer-move",r=>{const c={include:[this.layerView.layer]};this.hoverHitTest(r,c)})}animatePointPopEffect(e){e.symbolAnimation.start({to:this.to,onStart:()=>{const t=()=>this.cancelAnimation(e);switch(e.attributes.soundType){case"cat":{this.playSound(this.sounds.meowSound,t);break}case"trumpet":{this.playSound(this.sounds.trumpetSound,t);break}case"horn":{this.playSound(this.sounds.hornSound,t);break}case"guitar":{this.playSound(this.sounds.guitarSound,t);break}case"drum":{Math.random()>.5?this.playSound(this.sounds.drumSounds,t,"snare"):this.playSound(this.sounds.drumSounds,t,"hihat");break}default:t()}}})}cancelAnimation(e){e.symbolAnimation.start({to:{scale:1,rotate:0},onFinish:()=>{this.symbolAnimationManager.removeAnimatedGraphic({graphic:e})}})}playSound(e,t,o){e.off();const a=e.play(o);e.on("end",()=>{e.playing(a)===!1&&t()},a)}destroy(){this.clickHandler.remove(),this.hoverHandler.remove()}}const X="/Arcgis-Animate-Markers/assets/expressionless-face_1f611-18c3e2ac.png",Y="/Arcgis-Animate-Markers/assets/partying-face_1f973-fd5f4c50.png";class q{constructor({symbolAnimationManager:e,mapView:t,layerView:o,easingConfig:a={type:"easing",options:{easingFunction:"linear",duration:3e3}}}){s(this,"mapView");s(this,"layerView");s(this,"easingConfig");s(this,"symbolAnimationManager");s(this,"clickHandler");s(this,"hoverHandler");s(this,"confetti");s(this,"hoverHitTest",v(async(e,t)=>{const{results:o}=await this.mapView.hitTest(e,t);o.filter(i=>i.type="graphic").length?this.mapView.container.style.cursor="pointer":this.mapView.container.style.cursor="default"},70));s(this,"clickHitTest",async(e,t)=>{const{results:o}=await this.mapView.hitTest(e,t),a=o.filter(i=>i.type="graphic");if(a.length){const i=a[0].graphic;i.symbol=await b(i);const r=this.symbolAnimationManager.makeAnimatableSymbol({graphic:i,easingConfig:this.easingConfig});this.animatePointPopEffect(r)}});s(this,"onAnimationStep",(e,t,o)=>A(e));this.mapView=t,this.layerView=o,this.easingConfig=a,this.symbolAnimationManager=e;const i=document.createElement("canvas");i.classList.add("confetti-canvas"),t.ui.add(i,"manual"),this.confetti=H.create(i,{resize:!0,useWorker:!0}),this.clickHandler=u(()=>this.mapView,"click",r=>{const c={include:[this.layerView.layer]};this.clickHitTest(r,c)}),this.hoverHandler=u(()=>this.mapView,"pointer-move",r=>{const c={include:[this.layerView.layer]};this.hoverHitTest(r,c)})}animatePointPopEffect(e){e.symbolAnimation.start({onStep:this.onAnimationStep,onFinish:()=>{const t=this.mapView.toScreen(e.geometry);this.confetti({particleCount:140,spread:360,scalar:1.4,gravity:.8,startVelocity:20,origin:{x:t.x/this.mapView.width,y:t.y/this.mapView.height}}),e.symbol=A(1)}})}destroy(){this.clickHandler.remove(),this.hoverHandler.remove()}}function B(n){return[{type:"CIMVectorMarker",enable:n>0&&n<1,offsetX:17.5*(n-1),offsetY:-3,size:35,anchorPoint:{x:0,y:0},frame:{xmin:-100,ymin:0,xmax:100,ymax:100},markerGraphics:[{type:"CIMMarkerGraphic",primitiveName:"",textString:"",geometry:{rings:[[[-50*n,-20],[-50*n,-5],[50*n,-5],[50*n,-20]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:[113,200,55,255]}]}}]},{type:"CIMVectorMarker",enable:n>0&&n<1,offsetX:17.5*n,offsetY:-3,size:35,anchorPoint:{x:0,y:0},frame:{xmin:-100,ymin:0,xmax:100,ymax:100},markerGraphics:[{type:"CIMMarkerGraphic",primitiveName:"",textString:"",geometry:{rings:[[[-50*(1-n),-20],[-50*(1-n),-5],[50*(1-n),-5],[50*(1-n),-20]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:[255,0,0,255]}]}}]}]}function A(n){return new G({data:{type:"CIMSymbolReference",symbol:{type:"CIMPointSymbol",symbolLayers:[...B(n),{type:"CIMPictureMarker",enable:!0,anchorPoint:{x:0,y:0},offsetX:0,offsetY:0,size:40,scaleX:1,tintColor:[255,255,255,255],url:n<1?X:Y}]}}})}class K{constructor({symbolAnimationManager:e,mapView:t,layerView:o,to:a,easingConfig:i}){s(this,"mapView");s(this,"layerView");s(this,"to");s(this,"easingConfig");s(this,"symbolAnimationManager");s(this,"hoverHandler");s(this,"hitTest",v(async(e,t)=>{const{results:o}=await this.mapView.hitTest(e,t),a=o.filter(i=>i.type="graphic");if(a.length){const i=a[0].graphic;this.mapView.container.style.cursor="pointer",i.symbol=await b(i),this.activeGraphic=i}else this.mapView.container.style.cursor="default",this.activeGraphic=null},70));s(this,"_activeGraphic",null);this.mapView=t,this.layerView=o,this.to=a,this.easingConfig=i,this.symbolAnimationManager=e,this.hoverHandler=u(()=>this.mapView,"pointer-move",r=>{const c={include:[this.layerView.layer]};this.hitTest(r,c)})}set activeGraphic(e){if(e&&this.symbolAnimationManager.hasAnimatedGraphic({graphic:e}))return;if(this._activeGraphic===null){if(e===null)return}else{const o=this.symbolAnimationManager.getAnimatedGraphic({graphic:this._activeGraphic});o&&this.cancelAnimation(o)}if(this._activeGraphic=e,this._activeGraphic===null)return;const t=this.symbolAnimationManager.makeAnimatableSymbol({graphic:this._activeGraphic,easingConfig:this.easingConfig});this.animatePointPopEffect(t)}animatePointPopEffect(e){e.symbolAnimation.start({to:this.to})}cancelAnimation(e){e.symbolAnimation.start({to:{scale:1,rotate:0},onFinish:()=>{this.symbolAnimationManager.removeAnimatedGraphic({graphic:e})}})}destroy(){this.hoverHandler.remove()}}class S{constructor({symbolAnimationManager:e,graphics:t}){s(this,"symbolAnimationManager");s(this,"forwardAnimation",e=>{this.symbolAnimationManager.makeAnimatableSymbol({graphic:e,easingConfig:{type:"spring",options:{tension:100,friction:200,mass:1}},opacity:1,isOverlay:!1}).symbolAnimation.start({to:{scale:1.2,opacity:.5},onFinish:()=>{this.reverseAnimation(e)}})});s(this,"reverseAnimation",e=>{this.symbolAnimationManager.makeAnimatableSymbol({graphic:e,easingConfig:{type:"spring",options:{tension:100,friction:200,mass:1}},isOverlay:!1}).symbolAnimation.start({to:{scale:.6,opacity:1},onFinish:()=>{this.forwardAnimation(e)}})});this.symbolAnimationManager=e,this.pulseItems(t)}async pulseItems(e){for(const t of e)t.symbol=await b(t),window.setTimeout(()=>{this.forwardAnimation(t)},1e3*Math.random())}destroy(){}}class W{constructor({symbolAnimationManager:e,graphics:t}){s(this,"symbolAnimationManager");s(this,"intervalId");this.symbolAnimationManager=e,this.intervalId=this.animateRandomItem(t)}animateRandomItem(e){return window.setInterval(()=>{const t=Math.floor(Math.random()*e.length),a=e[t].clone();a.symbol=new k({color:[255,255,255,0],size:30,outline:{color:[255,0,0,1],style:"solid",width:4}});const i=Date.now().toString(),r=this.symbolAnimationManager.makeAnimatableSymbol({animationId:i,graphic:a,easingConfig:{type:"easing",options:{easingFunction:"easeInOutCubic",duration:1500}},isOverlay:!0});r.symbolAnimation.start({to:{scale:1.7,opacity:0},onFinish:()=>{this.symbolAnimationManager.removeAnimatedGraphic({graphic:r})}})},2e3)}destroy(){window.clearInterval(this.intervalId)}}const V=new P({basemap:new x({portalItem:{id:"a8c045aa74d643cc9e2fa2702cc4cb45"}})}),p=new T({container:"viewDiv",map:V,constraints:{minZoom:10},center:[-2.362,51.383],zoom:15}),Z=document.getElementById("titleDiv");p.ui.add(Z,"top-right");const y=document.getElementById("modeSelect");y.style.display="block";y.setAttribute("disabled","");y==null||y.addEventListener("change",n=>{$(n)});const l=new L({portalItem:{id:"ae3681977a0749e98867e42728196b3a"},popupEnabled:!1,outFields:["*"]});V.add(l);let h,m,f,g,w;p.whenLayerView(l).then(async n=>{w=await l.queryFeatures({where:"1=1",returnGeometry:!0,outFields:["*"]}),f=n,m=new F({mapView:p,layerView:n}),g=l.renderer.clone(),h=new S({symbolAnimationManager:m,graphics:w.features}),y.removeAttribute("disabled")});function $(n){if(n.target){const e=n.target,t=e.options[e.selectedIndex].value;switch(h.destroy(),m.removeAllAnimatedGraphics(),t){case"radar-ping":{l.renderer=g,h=new W({symbolAnimationManager:m,graphics:w.features});break}case"hover-pop-effect":{l.renderer=g,h=new K({symbolAnimationManager:m,mapView:p,layerView:f,to:{scale:1.5,rotate:10},easingConfig:{type:"spring",options:E.molasses}});break}case"click-pop-effect":{l.renderer=g,h=new D({symbolAnimationManager:m,mapView:p,layerView:f,to:{scale:1.5,rotate:20},easingConfig:{type:"spring",options:{tension:280,friction:40,mass:10}}});break}case"oscillate":{l.renderer=new M({symbol:new k({color:[255,255,255,1],size:30,outline:{color:[255,150,0,1],style:"solid",width:4}})}),h=new S({symbolAnimationManager:m,graphics:w.features});break}case"custom-animation":{l.renderer=new M({symbol:A(0)}),h=new q({symbolAnimationManager:m,mapView:p,layerView:f});break}}}}
