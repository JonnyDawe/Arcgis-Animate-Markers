var M=Object.defineProperty;var I=(c,e,t)=>e in c?M(c,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[e]=t;var r=(c,e,t)=>(I(c,typeof e!="symbol"?e+"":e,t),t);import{h as T,w as V,y as A,u as F,a as m,b as G,R as C,L as H,x as z,_ as O,H as j}from"./vendor-1f6204b4.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function t(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(a){if(a.ep)return;a.ep=!0;const i=t(a);fetch(a.href,i)}})();const u=c=>c.layer.type==="graphics",x=c=>c.type==="CIMVectorMarker",E=c=>c.type==="CIMPictureMarker";class N{constructor({layerView:e,mapView:t}){r(this,"mapView");r(this,"parentLayerView");r(this,"animationGraphicsLayer");r(this,"animatedGraphics");r(this,"graphicsObjectIdsToFilter",new Set);this.mapView=t,this.animatedGraphics={},this.parentLayerView=e,this.animationGraphicsLayer=this.setupAnimatedGraphicsLayer(e)}setupAnimatedGraphicsLayer(e){return u(e)?e.layer:(this.animationGraphicsLayer=new T({effect:e.layer.effect}),this.mapView.map.add(this.animationGraphicsLayer,this.mapView.layerViews.findIndex(t=>t===e)+1),e.featureEffect=new V({includedEffect:"opacity(0.001%)",filter:new A({where:"1<>1"})}),this.animationGraphicsLayer)}addExcludedFeature(e){this.graphicsObjectIdsToFilter.add(e),this.updateExcludedFeatures()}removeExcludedFeature(e){this.graphicsObjectIdsToFilter.delete(e),this.updateExcludedFeatures()}updateExcludedFeatures(){this.parentLayerView.featureEffect.filter=new A({where:`${this.parentLayerView.layer.objectIdField} IN ( ${Array.from(this.graphicsObjectIdsToFilter).join(",")} ) `})}hasAnimatedGraphic(e){const t=this.getGraphicId(e);return t!==void 0&&this.animatedGraphics[t]!==void 0}getAnimatedGraphic(e){const t=this.getGraphicId(e);return this.animatedGraphics[t.toString()]}getAllAnimatedGraphics(){return Object.values(this.animatedGraphics)??[]}makeAnimatableSymbol({graphic:e,easingConfig:t,isOverlay:s=!1}){const a=this.getGraphicId(e);if(this.hasAnimatedGraphic(e))return this.getAnimatedGraphic(e);const i=y.createAnimatedGraphic({graphic:e,easingConfig:t});return this.animatedGraphics[a.toString()]=i,u(this.parentLayerView)||(this.animationGraphicsLayer.add(i),this.addExcludedFeature(a)),i}removeAnimatedGraphic(e){const t=this.getGraphicId(e);if(this.hasAnimatedGraphic(e)){const s=this.getAnimatedGraphic(e);u(this.parentLayerView)?s.symbolAnimation.resetSymbol():(this.removeExcludedFeature(t),window.setTimeout(()=>{this.removeAnimatedGraphic(s),this.animationGraphicsLayer.remove(s)},50)),delete this.animatedGraphics[t.toString()]}}getGraphicId(e){return e.getObjectId()??e.uid}}class y{constructor({graphic:e,easingConfig:t}){r(this,"easingConfig");r(this,"graphic");r(this,"originalSymbol");r(this,"animationStartTimeStamp",0);r(this,"easeOutQuad",e=>e*(2-e));r(this,"updateSimpleMarkerScale",(e,t,s,{to:a})=>{const{size:i}=t,{size:n}=s,o=s.clone();return o.size=n+(i*a-n)*e,o});r(this,"updatePictureMarkerScale",(e,t,s,{to:a})=>{const{height:i,width:n}=t,{height:o,width:h}=s,l=s.clone();return l.width=h+(n*a-h)*e,l.height=o+(i*a-o)*e,console.log(l.width),console.log(l.height),l});r(this,"updateCIMSymbolPointMarkerScale",(e,t,s,{to:a})=>{const i=s.clone();for(const[n,o]of i.data.symbol.symbolLayers.entries()){if(x(o)){const h=t.data.symbol.symbolLayers[n];o.size=o.size+(h.size*a-o.size)*e}if(E(o)){const h=t.data.symbol.symbolLayers[n];o.size=o.size+(h.size*a-o.size)*e}}return i});r(this,"abortCurrentAnimation",()=>{});this.graphic=e,this.originalSymbol=e.symbol.clone(),this.easingConfig=t}static createAnimatedGraphic({graphic:e,easingConfig:t}){return e.symbolAnimation=new y({graphic:e,easingConfig:t}),e}resetAnimationTimeStamp(){this.animationStartTimeStamp=0}start(e){switch(e.type){case"symbol-scale":this.animateMarkerSize(e)}}animateMarkerSize(e){switch(this.originalSymbol.type){case"simple-marker":{this.animateSymbol(e,this.updateSimpleMarkerScale);break}case"picture-marker":{this.animateSymbol(e,this.updatePictureMarkerScale);break}case"cim":{this.animateSymbol(e,this.updateCIMSymbolPointMarkerScale);break}}}animateSymbol(e,t){var h,l;const s=this.graphic.symbol.clone(),a=this.easingConfig.type,i=a==="spring"?new F(0,{to:1,config:this.easingConfig.options}):null;(h=this.abortCurrentAnimation)==null||h.call(this),(l=e==null?void 0:e.onStart)==null||l.call(e);let n=!1;const o=f=>{var g,b,w,S;this.animationStartTimeStamp===0&&(this.animationStartTimeStamp=f);const d=f-this.animationStartTimeStamp;if(n){this.resetAnimationTimeStamp();return}if(a==="easing"&&d<(((b=(g=this.easingConfig)==null?void 0:g.options)==null?void 0:b.duration)??0)||(i==null?void 0:i.idle)!==!0){i&&(i.advance(d),console.log(i==null?void 0:i.get()));const v=a==="spring"?(i==null?void 0:i.get())??0:this.easeOutQuad(d/(((w=this.easingConfig.options)==null?void 0:w.duration)??0));this.graphic.symbol=t(v,this.originalSymbol,s,e),window.requestAnimationFrame(o)}else this.resetAnimationTimeStamp(),(S=e==null?void 0:e.onFinish)==null||S.call(e)};window.requestAnimationFrame(o),this.abortCurrentAnimation=()=>{n=!0}}resetSymbol(){this.graphic.symbol=this.originalSymbol}}const q="/Arcgis-Animate-Markers/assets/bugle-f4909af2.wav",$="/Arcgis-Animate-Markers/assets/cat-427afe9d.wav",Q="/Arcgis-Animate-Markers/assets/drums-a00e44f7.mp3",W="/Arcgis-Animate-Markers/assets/guitar-ecd5b111.wav",D="/Arcgis-Animate-Markers/assets/trumpet-c3f50bf2.wav";function K(c,e){let t,s,a;const i=async()=>{s&&(a=c(...s),s=void 0),t=void 0};return async(...n)=>(s=n,t||(a=c(...n),t=window.setTimeout(i,e)),a)}class R{constructor({symbolAnimationManager:e,mapView:t,layerView:s,scaleFactor:a,easingConfig:i={type:"spring",options:{tension:280,friction:40,mass:10}}}){r(this,"mapView");r(this,"layerView");r(this,"scaleFactor");r(this,"easingConfig");r(this,"symbolAnimationManager");r(this,"clickHandler");r(this,"hoverHandler");r(this,"meowSound",new m.Howl({src:$}));r(this,"trumpetSound",new m.Howl({src:D}));r(this,"hornSound",new m.Howl({src:q}));r(this,"guitarSound",new m.Howl({src:W}));r(this,"drumSounds",new m.Howl({src:Q,sprite:{kick:[0,350],hihat:[374,160],snare:[666,290],cowbell:[968,200]}}));r(this,"hoverHitTest",K(async(e,t)=>{const{results:s}=await this.mapView.hitTest(e,t);s.filter(i=>i.type="graphic").length?this.mapView.container.style.cursor="pointer":this.mapView.container.style.cursor="default"},70));r(this,"clickHitTest",async(e,t)=>{const{results:s}=await this.mapView.hitTest(e,t),a=s.filter(i=>i.type="graphic");if(a.length){const i=a[0].graphic;i.symbol=await C(i),this.activeGraphic=i}else this.activeGraphic=null});this.mapView=t,this.layerView=s,this.scaleFactor=a,this.easingConfig=i,this.symbolAnimationManager=e,this.clickHandler=G(()=>this.mapView,"click",n=>{const o={include:[this.layerView.layer]};this.clickHitTest(n,o)}),this.hoverHandler=G(()=>this.mapView,"pointer-move",n=>{const o={include:[this.layerView.layer]};this.hoverHitTest(n,o)})}set activeGraphic(e){if(e){const t=this.symbolAnimationManager.makeAnimatableSymbol({graphic:e,easingConfig:this.easingConfig});this.animatePointPopEffect(t)}}animatePointPopEffect(e){e.symbolAnimation.start({type:"symbol-scale",to:this.scaleFactor,onStart:()=>{const t=()=>this.cancelAnimation(e);switch(e.attributes.soundType){case"cat":{this.playSound(this.meowSound,t);break}case"trumpet":{this.playSound(this.trumpetSound,t);break}case"horn":{this.playSound(this.hornSound,t);break}case"guitar":{this.playSound(this.guitarSound,t);break}case"drum":{Math.random()>.5?this.playSound(this.drumSounds,t,"snare"):this.playSound(this.drumSounds,t,"hihat");break}}}})}cancelAnimation(e){e.symbolAnimation.start({type:"symbol-scale",to:1,onFinish:()=>{this.symbolAnimationManager.removeAnimatedGraphic(e)}})}playSound(e,t,s){e.off();const a=e.play(s);e.on("end",()=>{e.playing(a)===!1&&t()},a)}destroy(){this.clickHandler.remove(),this.hoverHandler.remove()}}const k=new H({basemap:new z({portalItem:{id:"a8c045aa74d643cc9e2fa2702cc4cb45"}})}),p=new O({container:"viewDiv",map:k,constraints:{minZoom:10},center:[-2.362,51.383],zoom:15}),L=new j({portalItem:{id:"ae3681977a0749e98867e42728196b3a"},popupEnabled:!1});k.add(L);p.whenLayerView(L).then(c=>{const e=new N({mapView:p,layerView:c});new R({symbolAnimationManager:e,mapView:p,layerView:c,scaleFactor:1.5})});
